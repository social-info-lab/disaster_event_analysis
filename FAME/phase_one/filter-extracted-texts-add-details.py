import json
from collections import Counter
filenames = ['avalanche-afghanistan-2020-02-13.json','flood-indonesia-2020-01-23.json','avalanche-turkey-2020-02-04.json','flood-indonesia-2020-01-28.json','flood-indonesia-2020-02-11.json','storm-bangladesh-2020-05-20.json','flood-indonesia-2020-02-13.json','storm-el salvador-2020-05-31.json','flood-indonesia-2020-02-26.json','storm-fiji-2020-01-17.json','flood-indonesia-2020-03-04.json','storm-fiji-2020-04-08.json','flood-indonesia-2020-03-20.json','storm-guatemala-2020-05-30.json','flood-indonesia-2020-03-29.json','storm-honduras-2020-05-30.json','flood-indonesia-2020-04-04.json','storm-india-2020-05-20.json','flood-indonesia-2020-04-09.json','storm-madagaskar-2020-03-13.json','flood-indonesia-2020-04-20.json','storm-philippines-2020-05-15.json','flood-indonesia-2020-04-30.json','storm-solomon islands-2020-04-02.json','flood-indonesia-2020-05-08.json','storm-sri lanka-2020-05-17.json','flood-indonesia-2020-05-22.json','storm-tonga-2020-04-06.json','flood-iran-2020-01-09.json','storm-tuvalu-2020-01-18.json','flood-iran-2020-02-24.json','storm-vanuatu-2020-04-06.json','flood-iran-2020-04-10.json','flood-iraq-2020-03-18.json','flood-israel-2020-01-04.json','flood-kazakhstan-2020-05-01.json','earthquake-china-2020-01-19.json','flood-kenya-2020-04-18.json','earthquake-china-2020-02-06.json','flood-madagaskar-2020-01-01.json','earthquake-china-2020-05-18.json','flood-malawi-2020-02-04.json','earthquake-croatia-2020-03-22.json','flood-malaysia-2020-04-25.json','earthquake-greece-2020-05-15.json','flood-mozambique-2020-02-11.json','earthquake-honduras-2020-05-02.json','flood-namibia-2020-03-06.json','earthquake-indonesia-2020-01-07.json','flood-new zealand-2020-02-01.json','earthquake-indonesia-2020-01-18.json','flood-pakistan-2020-03-04.json','earthquake-indonesia-2020-01-19.json','flood-pakistan-2020-03-31.json','earthquake-indonesia-2020-01-27.json','flood-papua new guinea-2020-02-05.json','earthquake-indonesia-2020-02-05.json','flood-papua new guinea-2020-03-21.json','earthquake-indonesia-2020-02-08.json','flood-papua new guinea-2020-04-04.json','earthquake-indonesia-2020-03-18.json','flood-peru-2020-01-23.json','earthquake-indonesia-2020-03-31.json','flood-peru-2020-02-17.json','earthquake-indonesia-2020-04-14.json','flood-peru-2020-03-28.json','earthquake-indonesia-2020-04-25.json','flood-republic of south africa-2020-02-07.json','earthquake-iran-2020-02-23.json','flood-rwanda-2020-02-02.json','earthquake-jamaica-2020-03-06.json','flood-rwanda-2020-03-02.json','earthquake-japan-2020-05-06.json','flood-rwanda-2020-04-17.json','earthquake-japan-2020-05-07.json','flood-rwanda-2020-05-01.json','earthquake-mexico-2020-05-31.json','flood-somalia-2020-04-20.json','earthquake-papua new guinea-2020-01-07.json','flood-tajikistan-2020-05-14.json','earthquake-papua new guinea-2020-01-28.json','flood-uganda-2020-04-17.json','earthquake-papua new guinea-2020-03-22.json','flood-uganda-2020-05-08.json','earthquake-papua new guinea-2020-05-12.json','flood-uganda-2020-05-21.json','earthquake-papua new guinea-2020-05-22.json','flood-united kingdom-2020-02-28.json','earthquake-philippines-2020-03-18.json','flood-united republic of tanzania-2020-01-27.json','earthquake-philippines-2020-04-18.json','flood-united republic of tanzania-2020-03-10.json','earthquake-russian federation-2020-01-09.json','flood-united republic of tanzania-2020-04-22.json','earthquake-russian federation-2020-01-29.json','flood-uzbekistan-2020-05-01.json','earthquake-russian federation-2020-03-25.json','flood-yemen-2020-03-25.json','earthquake-russian federation-2020-04-16.json','flood-yemen-2020-04-15.json','earthquake-solomon islands-2020-02-26.json','flood-zambia-2020-01-xx.json','earthquake-solomon islands-2020-03-17.json','flood-zambia-2020-03-20.json','earthquake-solomon islands-2020-05-27.json','landslide-ethiopia-2020-05-09.json','earthquake-tonga-2020-04-05.json','landslide-ethiopia-2020-05-28.json','earthquake-turkey-2020-01-24.json','landslide-india-2020-05-27.json','earthquake-turkey-2020-02-13.json','landslide-papua new guinea-2020-04-10.json','earthquake-turkey-2020-02-23.json','earthquake-vanuatu-2020-04-12.json','flood-afghanistan-2020-03-28.json','flood-afghanistan-2020-04-13.json','flood-afghanistan-2020-05-02.json','flood-angola-2020-03-16.json','flood-angola-2020-04-18.json','flood-argentina-2020-02-11.json','landslide-peru-2020-02-23.json','flood-australia-2020-02-04.json','storm-afghanistan-2020-01-12.json','flood-bolivia-2020-02-08.json','storm-argentina-2020-01-15.json','flood-bolivia-2020-02-13.json','storm-australia-2020-01-19.json','flood-brazil-2020-01-17.json','storm-belgium-2020-02-09.json','flood-brazil-2020-02-09.json','storm-burundi-2020-03-16.json','flood-brazil-2020-02-29.json','storm-china-2020-05-01.json','flood-brazil-2020-03-02.json','storm-cuba-2020-05-25.json','flood-burkina faso-2020-04-19.json','storm-czech republic-2020-02-07.json','flood-burundi-2020-01-28.json','storm-france-2020-01-21.json','flood-burundi-2020-04-13.json','storm-france-2020-02-08.json','flood-canada-2020-04-26.json','storm-germany-2020-02-09.json','flood-chad-2020-04-20.json','storm-india-2020-01-11.json','flood-china-2020-05-21.json','storm-italy-2020-02-08.json','flood-colombia-2020-02-26.json','storm-mongolia-2020-01-xx.json','flood-congo-2020-03-30.json','storm-oman-2020-05-27.json','storm-pakistan-2020-01-11.json','flood-democratic republic of the congo-2020-03-17.json','storm-poland-2020-02-08.json','flood-democratic republic of the congo-2020-04-16.json','storm-slovenia-2020-02-07.json','flood-democratic republic of the congo-2020-05-05.json','storm-spain-2020-01-19.json','flood-djibouti-2020-04-20.json','storm-sweden-2020-02-07.json','flood-ecuador-2020-02-22.json','storm-thailand-2020-04-29.json','flood-egypt-2020-03-11.json','storm-turkey-2020-01-07.json','flood-ethiopia-2020-04-20.json','storm-united kingdom-2020-02-08.json','flood-france-2020-05-11.json','storm-vietnam-2020-03-02.json','flood-guatemala-2020-05-09.json','storm-vietnam-2020-04-22.json','flood-honduras-2020-02-28.json','volcano-philippines-2020-01-12.json','flood-india-2020-05-10.json','wildfire-bolivia-2020-01-xx.json','flood-india-2020-05-24.json','wildfire-china-2020-03-30.json','flood-indonesia-2020-01-14.json','storm-united states of america-2020-01-10.json','storm-united states of america-2020-03-02.json','storm-united states of america-2020-04-06.json','storm-united states of america-2020-04-10.json','storm-united states of america-2020-05-02.json','flood-united states of america-2020-02-10.json','flood-united states of america-2020-05-17.json']
import pandas as pd
iso3toiso2dict = {"AFG": "AF","ALB": "AL","DZA": "DZ","ASM": "AS","AND": "AD","AGO": "AO","AIA": "AI","ATA": "AQ","ATG": "AG","ARG": "AR","ARM": "AM","ABW": "AW","AUS": "AU","AUT": "AT","AZE": "AZ","BHS": "BS","BHR": "BH","BGD": "BD","BRB": "BB","BLR": "BY","BEL": "BE","BLZ": "BZ","BEN": "BJ","BMU": "BM","BTN": "BT","BOL": "BO","BES": "BQ","BIH": "BA","BWA": "BW","BVT": "BV","BRA": "BR","IOT": "IO","BRN": "BN","BGR": "BG","BFA": "BF","BDI": "BI","CPV": "CV","KHM": "KH","CMR": "CM","CAN": "CA","CYM": "KY","CAF": "CF","TCD": "TD","CHL": "CL","CHN": "CN","CXR": "CX","CCK": "CC","COL": "CO","COM": "KM","COD": "CD","COG": "CG","COK": "CK","CRI": "CR","HRV": "HR","CUB": "CU","CUW": "CW","CYP": "CY","CZE": "CZ","CIV": "CI","DNK": "DK","DJI": "DJ","DMA": "DM","DOM": "DO","ECU": "EC","EGY": "EG","SLV": "SV","GNQ": "GQ","ERI": "ER","EST": "EE","SWZ": "SZ","ETH": "ET","FLK": "FK","FRO": "FO","FJI": "FJ","FIN": "FI","FRA": "FR","GUF": "GF","PYF": "PF","ATF": "TF","GAB": "GA","GMB": "GM","GEO": "GE","DEU": "DE","GHA": "GH","GIB": "GI","GRC": "GR","GRL": "GL","GRD": "GD","GLP": "GP","GUM": "GU","GTM": "GT","GGY": "GG","GIN": "GN","GNB": "GW","GUY": "GY","HTI": "HT","HMD": "HM","VAT": "VA","HND": "HN","HKG": "HK","HUN": "HU","ISL": "IS","IND": "IN","IDN": "ID","IRN": "IR","IRQ": "IQ","IRL": "IE","IMN": "IM","ISR": "IL","ITA": "IT","JAM": "JM","JPN": "JP","JEY": "JE","JOR": "JO","KAZ": "KZ","KEN": "KE","KIR": "KI","PRK": "KP","KOR": "KR","KWT": "KW","KGZ": "KG","LAO": "LA","LVA": "LV","LBN": "LB","LSO": "LS","LBR": "LR","LBY": "LY","LIE": "LI","LTU": "LT","LUX": "LU","MAC": "MO","MDG": "MG","MWI": "MW","MYS": "MY","MDV": "MV","MLI": "ML","MLT": "MT","MHL": "MH","MTQ": "MQ","MRT": "MR","MUS": "MU","MYT": "YT","MEX": "MX","FSM": "FM","MDA": "MD","MCO": "MC","MNG": "MN","MNE": "ME","MSR": "MS","MAR": "MA","MOZ": "MZ","MMR": "MM","NAM": "NA","NRU": "NR","NPL": "NP","NLD": "NL","NCL": "NC","NZL": "NZ","NIC": "NI","NER": "NE","NGA": "NG","NIU": "NU","NFK": "NF","MNP": "MP","NOR": "NO","OMN": "OM","PAK": "PK","PLW": "PW","PSE": "PS","PAN": "PA","PNG": "PG","PRY": "PY","PER": "PE","PHL": "PH","PCN": "PN","POL": "PL","PRT": "PT","PRI": "PR","QAT": "QA","MKD": "MK","ROU": "RO","RUS": "RU","RWA": "RW","REU": "RE","BLM": "BL","SHN": "SH","KNA": "KN","LCA": "LC","MAF": "MF","SPM": "PM","VCT": "VC","WSM": "WS","SMR": "SM","STP": "ST","SAU": "SA","SEN": "SN","SRB": "RS","SYC": "SC","SLE": "SL","SGP": "SG","SXM": "SX","SVK": "SK","SVN": "SI","SLB": "SB","SOM": "SO","ZAF": "ZA","SGS": "GS","SSD": "SS","ESP": "ES","LKA": "LK","SDN": "SD","SUR": "SR","SJM": "SJ","SWE": "SE","CHE": "CH","SYR": "SY","TWN": "TW","TJK": "TJ","TZA": "TZ","THA": "TH","TLS": "TL","TGO": "TG","TKL": "TK","TON": "TO","TTO": "TT","TUN": "TN","TUR": "TR","TKM": "TM","TCA": "TC","TUV": "TV","UGA": "UG","UKR": "UA","ARE": "AE","GBR": "GB","UMI": "UM","USA": "US","URY": "UY","UZB": "UZ","VUT": "VU","VEN": "VE","VNM": "VN","VGB": "VG","VIR": "VI","WLF": "WF","ESH": "EH","YEM": "YE","ZMB": "ZM","ZWE": "ZW","ALA": "AX"}
df = pd.read_csv('media-id-country-mapping.csv')

for fn in filenames:
    f = open(fn,"r")
    data = json.load(f)["arr"]
    titledatearr = []
    newcounts = {}
    for d in data:
        mediaid = d["media id"]
        if len(df.loc[df['media_id']==int(mediaid)]) == 0:
            continue
        else:
            x = str(df.loc[df['media_id']==int(mediaid)]['pub_country']).replace('\nName: pub_country, dtype: object','').replace("0","").replace("1","").replace("2","").replace("3","").replace("4","").replace("5","").replace("6","").replace("7","").replace("8","").replace("9","").replace("    ","").replace("\n","")
            if x[0] == " ":
                x = x[1:]
            x = x[:3]
            pubcountry = x
        if pubcountry.lower() == "nan":
            continue
        if d["date"] not in newcounts:
            newcounts[d["date"]] = 1
        else:
            newcounts[d["date"]] = newcounts[d["date"]] + 1
        d["pub country"] = pubcountry
        chunks = d["article"].replace(". . ",". ").split(". ")
        art = ""
        for i in range(0,len(chunks)):
            art = art + chunks[i] + ". "
        titledatearr.append([d["title"]+". "+art,d["date"],pubcountry])
    with open(fn.replace(".json","")+'-filteredtext.json','w') as f:
        json.dump({"arr":titledatearr},f)

